<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Onboarding</title>
    <!-- Add 3D animation library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            background: none; /* Remove existing background */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            overflow: hidden;
        }

        /* Adjust overlay opacity for better visibility */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5); /* Slightly darker overlay */
            z-index: 0;
        }

        /* Update container for better contrast against new background */
        

        /* Update cloud styles */
        .cloud {
            background: rgba(255, 255, 255, 0.6) !important;
            filter: blur(3px);
        }

        /* Remove the terminal and control tower since they're in the background image */
        .terminal, .control-tower {
            display: none;
        }

        /* Update background planes to be more visible */
        .background-plane {
            filter: brightness(1.2);
            opacity: 0.6;
        }

        /* Add runway markings */
        body::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 40vh;
            background: repeating-linear-gradient(
                transparent 0%,
                transparent 45%,
                #FFFFFF 45%,
                #FFFFFF 55%,
                transparent 55%,
                transparent 100%
            );
            background-size: 100% 100px;
            opacity: 0.5;
            z-index: 0;
        }

        /* Add clouds */
        .cloud {
            background: white !important;
            border-radius: 20px !important;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            opacity: 0.8 !important;
        }

        /* Add terminal building silhouette */
        .terminal {
            position: absolute;
            bottom: 20%;
            right: 5%;
            width: 200px;
            height: 150px;
            background: #2c3e50;
            opacity: 0.7;
            clip-path: polygon(
                0% 100%,
                0% 40%,
                20% 40%,
                20% 30%,
                40% 20%,
                60% 20%,
                80% 30%,
                80% 40%,
                100% 40%,
                100% 100%
            );
        }

        /* Add control tower */
        .control-tower {
            position: absolute;
            bottom: 20%;
            left: 10%;
            width: 40px;
            height: 200px;
            background: linear-gradient(to bottom, #34495e, #2c3e50);
            opacity: 0.8;
        }

        .control-tower::after {
            content: '';
            position: absolute;
            top: -30px;
            left: -10px;
            width: 60px;
            height: 40px;
            background: #34495e;
            border-radius: 10px;
        }

        /* Update h1 style to remove container and adjust transparency */
        h1 {
            color: rgba(255, 255, 255, 0.8);
            margin: 0 0 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            font-size: 2.2em;
            padding: 15px 30px;
            display: inline-block;
            /* Remove these properties */
            background: none;
            border-radius: 0;
            backdrop-filter: none;
            border: none;
        }

        h1:hover {
            color: rgba(255, 255, 255, 0.9);
            /* Remove background change on hover */
            background: none;
            transition: color 0.3s ease;
        }

        .journey-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            transform-style: preserve-3d;
            flex: 1;
            gap: 100px;
            padding: 0 50px;
        }

        .person-section {
            flex: 1;
            padding: 10px;
            transform: translateZ(50px);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin-top: 120px;
        }

        .person-image {
            width: 150px;
            height: auto;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            filter: none;
            opacity: 1;
        }

        .person-image:hover {
            transform: translateZ(30px) scale(1.1);
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        .airplane-section {
            flex: 1;
            position: relative;
            perspective: 1000px;
            padding: 10px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            min-width: 300px;
            margin-left: -50px;
        }

        .airplane-image {
            width: 100px;
            height: auto;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            filter: none;
            object-fit: contain;
            transform: rotate(-10deg) translateX(20px);
            opacity: 1;
            z-index: 10;
        }

        .airplane-image:hover {
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        .airplane-image.landing {
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .destinations-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .destination {
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 15px;
            transform-style: preserve-3d;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
        }

        .destination:hover {
            transform: translateZ(30px) scale(1.05);
            background: rgba(255, 255, 255, 0.25);
        }

        .destination-content img {
            width: 60px !important;
            height: 60px !important;
        }

        .destination-content h2 {
            font-size: 1.5em;
        }

        .destination-content p {
            font-size: 0.9em;
        }

        .destinations-section h3 {
            margin: 0 0 15px 0;
            font-size: 1.2em;
        }

        .radio-input {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #4CAF50;
        }

        .destination-content {
            flex: 1;
            text-align: left;
            color: white;
        }

        .destination-content h2 {
            margin: 0;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .destination-content p {
            margin: 10px 0 0;
            opacity: 0.9;
        }

        @keyframes loadingBounce {
            0%, 100% {
                transform: translateY(0) rotateX(0) rotateZ(0);
            }
            50% {
                transform: translateY(-40px) rotateX(-10deg) rotateZ(-5deg);
            }
        }

        @keyframes flyToUat {
            0% {
                transform: translate3d(20px, 0, 0) rotate(-10deg);
            }
            25% {
                transform: translate3d(200px, 100px, 50px) rotate(15deg);
            }
            75% {
                transform: translate3d(400px, 200px, 100px) rotate(-5deg);
            }
            100% {
                transform: translate3d(600px, 300px, 0) rotate(0deg) scale(0.6);
            }
        }

        @keyframes flyToPreprod {
            0% {
                transform: translate3d(20px, 0, 0) rotate(-10deg);
            }
            25% {
                transform: translate3d(200px, -100px, 50px) rotate(15deg);
            }
            75% {
                transform: translate3d(400px, -200px, 100px) rotate(-5deg);
            }
            100% {
                transform: translate3d(600px, -300px, 0) rotate(0deg) scale(0.6);
            }
        }

        .loading-animation {
            animation: loadingBounce 1.5s infinite ease-in-out;
        }

        .flying-uat {
            animation: flyToUat 3s forwards cubic-bezier(0.4, 0, 0.2, 1);
        }

        .flying-preprod {
            animation: flyToPreprod 3s forwards cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Cloud particles */
        .clouds {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateX(-100%) translateY(0);
            }
            100% {
                transform: translateX(100vw) translateY(0);
            }
        }

        /* Update the waiting animation to be more natural */
        @keyframes waiting {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-15px) rotate(1deg);
            }
        }

        .person-image {
            animation: waiting 2s ease-in-out infinite;
        }

        /* Stop the waiting animation when clicked */
        .person-image.clicked {
            animation: none;
        }

        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            min-width: 300px;
            animation: popupAppear 0.3s ease-out;
        }

        @keyframes popupAppear {
            from {
                transform: translate(-50%, -60%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .popup-content h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }

        .onboarding-details {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .onboarding-details p {
            margin: 10px 0;
            color: #34495e;
            font-size: 1.1em;
        }

        .onboarding-details strong {
            color: #2c3e50;
            min-width: 100px;
            display: inline-block;
        }

        .close-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            width: 100%;
            transition: background 0.3s;
        }

        .close-btn:hover {
            background: #2980b9;
        }

        /* Add dynamic background layers */
        .background-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .background-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: transform 0.3s ease-out;
        }

        .layer-1 {
            background-image: url('https://images.unsplash.com/photo-1542296332-2e4473faf563');
            opacity: 0.9;
            transform: scale(1.1);
        }

        .layer-2 {
            background: linear-gradient(
                135deg,
                rgba(0, 0, 0, 0.4) 0%,
                rgba(0, 0, 0, 0.6) 100%
            );
        }

        /* Add runway lights effect */
        .runway-lights {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 50vh;
            background: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 49%,
                rgba(255, 255, 0, 0.2) 49.5%,
                rgba(255, 255, 0, 0.2) 50.5%,
                transparent 51%,
                transparent 100%
            );
            animation: runwayLights 2s infinite linear;
        }

        @keyframes runwayLights {
            0% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                opacity: 0.3;
            }
        }

        /* Add moving lights effect */
        .moving-lights {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(
                    circle at 50% 50%,
                    rgba(255, 255, 255, 0.1) 0%,
                    transparent 50%
                );
            animation: moveLights 8s infinite linear;
        }

        @keyframes moveLights {
            0% {
                transform: translateX(-50%) translateY(-50%) scale(1);
            }
            50% {
                transform: translateX(50%) translateY(50%) scale(2);
            }
            100% {
                transform: translateX(-50%) translateY(-50%) scale(1);
            }
        }

        /* Update container width */
        .container {
            max-width: 1400px;
            width: 95%;
        }

        /* Add highlight effect for selected destination */
        .destination.selected {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* Add styles for audio control (optional) */
        .audio-control {
            display: none;
        }

        /* Add thought bubble styles */
        .thought-bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            padding: 15px 25px;
            border-radius: 30px;
            color: white;
            font-style: italic;
            font-size: 1.1em;
            max-width: 250px;
            top: -120px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
        }

        /* Adjust thought bubble circles position */
        .thought-bubble::before {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
        }

        .thought-bubble::after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 50%;
            width: 12px;
            height: 12px;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Update floating animation to keep thought bubble centered */
        @keyframes floating {
            0%, 100% {
                transform: translateX(-50%) translateY(0) scale(1);
            }
            50% {
                transform: translateX(-50%) translateY(-5px) scale(1.02);
            }
        }

        .thought-bubble {
            animation: floating 3s ease-in-out infinite;
        }

        /* Update Info Icon and Tooltip Styles */
        .info-container {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .info-icon {
            color: #2ecc71;
            font-size: 1.2rem; /* Reduced size */
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            padding: 5px; /* Reduced padding */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-icon:hover {
            color: #27ae60;
            transform: scale(1.1);
        }

        .tooltip {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            width: 280px;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 2px solid #2ecc71;
        }

        .info-container:hover .tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(5px);
        }

        .tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            right: 15px;
            transform: rotate(45deg);
            width: 16px;
            height: 16px;
            background: white;
            border-left: 2px solid #2ecc71;
            border-top: 2px solid #2ecc71;
        }

        .user-details {
            display: grid;
            gap: 8px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(46, 204, 113, 0.1);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 80px;
        }

        .detail-value {
            color: #2c3e50;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- Cloud background -->
    <div class="clouds" id="clouds"></div>

    <div class="container">
        <h1>Welcome to Open Money</h1>
        <div class="journey-container">
            <div class="person-section">
                <div class="info-container">
                    <i class="fas fa-info-circle info-icon"></i>
                    <div class="tooltip">
                        <div class="user-details">
                            <div class="detail-item">
                                <span class="detail-label">Destination:</span>
                                <span class="detail-value" id="selectedEnvironment">PreProd</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Username:</span>
                                <span class="detail-value" id="generatedUsername">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Email:</span>
                                <span class="detail-value" id="generatedEmail">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value">Ready to Onboard</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Last Update:</span>
                                <span class="detail-value" id="lastUpdate">Just now</span>
                            </div>
                        </div>
                    </div>
                </div>
                <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/People/Man%20Standing.png" 
                     alt="Person Waiting" 
                     class="person-image" 
                     id="personImage">
                <div class="thought-bubble">
                    "Help me to land on Open Money by clicking on me"
                </div>
            </div>

            <div class="airplane-section">
                <img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Travel%20and%20places/Airplane.png" 
                     alt="Airplane" 
                     class="airplane-image" 
                     id="airplaneImage">
            </div>

            <div class="destinations-section">
                <h3 style="color: white; text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);">
                    Select your destination
                </h3>
                
                <!-- PreProd destination (now first) -->
                <div class="destination">
                    <input type="radio" name="environment" value="preprod" class="radio-input" id="preprodRadio" default checked>
                    <div class="destination-content">
                        <img src="https://cdn-icons-png.flaticon.com/512/4116/4116437.png" 
                             alt="PreProd Environment" 
                             style="width: 80px; height: 80px;">
                        <h2>PreProd</h2>
                        <p>The place where bugs are found</p>
                    </div>
                </div>

                <!-- UAT destination (now second) -->
                <div class="destination">
                    <input type="radio" name="environment" value="uat" class="radio-input" id="uatRadio">
                    <div class="destination-content">
                        <img src="https://cdn-icons-png.flaticon.com/512/4116/4116437.png" 
                             alt="UAT Environment" 
                             style="width: 80px; height: 80px;">
                        <h2>UAT</h2>
                        <p>The place where bugs are fixed</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add this popup HTML just before the closing </div> of container -->
        <div class="popup" id="onboardingPopup">
            <div class="popup-content">
                <h2>Please find your onboarding details</h2>
                <div class="onboarding-details">
                    <p><strong>Environment:</strong> <span id="envDetail"></span></p>
                    <p><strong>User ID:</strong> <span id="userIdDetail"></span></p>
                    <p><strong>Email:</strong> <span id="emailDetail"></span></p>
                    <p><strong>Timestamp:</strong> <span id="timestampDetail"></span></p>
                </div>
                <button class="close-btn" onclick="closePopup()">Close</button>
            </div>
        </div>
    </div>

    <!-- Add these elements just after the body tag -->
    <div class="terminal"></div>
    <div class="control-tower"></div>

    <!-- Add this right after the body tag -->
    <div class="background-wrapper">
        <div class="background-layer layer-1"></div>
        <div class="background-layer layer-2"></div>
        <div class="runway-lights"></div>
        <div class="moving-lights"></div>
    </div>

    <script>
        // Create floating clouds
        function createClouds() {
            const cloudsContainer = document.getElementById('clouds');
            for (let i = 0; i < 20; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.style.top = `${Math.random() * 100}%`;
                cloud.style.left = `${Math.random() * 100}%`;
                cloud.style.width = `${Math.random() * 50 + 20}px`;
                cloud.style.height = `${Math.random() * 50 + 20}px`;
                cloud.style.opacity = Math.random() * 0.3;
                cloud.style.animationDuration = `${Math.random() * 20 + 10}s`;
                cloud.style.animationDelay = `${Math.random() * 10}s`;
                cloudsContainer.appendChild(cloud);
            }
        }

        createClouds();

        // Existing JavaScript
        const personImage = document.getElementById('personImage');
        const airplaneImage = document.getElementById('airplaneImage');

        // Add environment selection handler
        document.querySelectorAll('input[name="environment"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const selectedEnv = this.value;
                const envDisplay = document.getElementById('selectedEnvironment');
                envDisplay.textContent = selectedEnv.charAt(0).toUpperCase() + selectedEnv.slice(1);
            });
        });

        // Update the existing generateUserData function
        function generateUserData() {
            const randomID = Math.floor(100000 + Math.random() * 900000);
            const selectedEnv = document.querySelector('input[name="environment"]:checked')?.value || 'preprod';
            const email = `bugs+${selectedEnv}${randomID}@bankopen.co`;
            const mobile = Math.floor(1000000000 + Math.random() * 9000000000);
            
            return {
                email: email,
                username: mobile.toString()
            };
        }

        // Update tooltip with generated data
        const infoIcon = document.querySelector('.info-icon');
        let userData = null;

        infoIcon.addEventListener('mouseenter', () => {
            if (!userData) {
                userData = generateUserData();
                document.getElementById('generatedUsername').textContent = userData.username;
                document.getElementById('generatedEmail').textContent = userData.email;
            }
        });

        // Update the data when registration is successful
        async function callRegistrationApi(environment) {
            // Generate random user data
            userData = generateUserData();
            
            const requestData = {
                email: userData.email,
                password: 'Test@123',
                username: userData.username,
                env: environment === 'preprod' ? 'pre-prod' : environment,
                env_val: null,
                action: 'register'
            };

            // Update tooltip with the generated data
            document.getElementById('generatedUsername').textContent = userData.username;
            document.getElementById('generatedEmail').textContent = userData.email;

            const response = await fetch('/api/create-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) {
                throw new Error('Registration failed');
            }

            const data = await response.json();
            return {
                success: true,
                message: "Registration successful",
                data: {
                    environment: environment,
                    userId: data.userId || data.username || requestData.username,
                    timestamp: new Date().toISOString(),
                    email: data.email || requestData.email,
                    ...data
                }
            };
        }

        // Update the registerUser function
        async function registerUser(environment) {
            try {
                document.querySelectorAll('.destination').forEach(dest => {
                    dest.classList.remove('selected');
                });

                const selectedDest = document.querySelector(`input[value="${environment}"]`).closest('.destination');
                selectedDest.classList.add('selected');

                airplaneImage.classList.add('loading-animation');
                
                // Call the real API instead of mockApiCall
                const data = await callRegistrationApi(environment);
                console.log('Registration successful:', data);
                
                airplaneImage.classList.remove('loading-animation');
                airplaneImage.classList.add('landing');
                
                // Start flight animation
                if (environment === 'uat') {
                    airplaneImage.classList.add('flying-uat');
                } else {
                    airplaneImage.classList.add('flying-preprod');
                }
                
                // Wait for flight animation to complete
                await new Promise(resolve => {
                    airplaneImage.addEventListener('animationend', () => {
                        const destRect = selectedDest.getBoundingClientRect();
                        const containerRect = document.querySelector('.journey-container').getBoundingClientRect();
                        
                        const relativeX = destRect.left - containerRect.left + (destRect.width / 2) - 30;
                        const relativeY = destRect.top - containerRect.top + (destRect.height / 2) - 30;
                        
                        requestAnimationFrame(() => {
                            airplaneImage.style.transform = `translate3d(${relativeX}px, ${relativeY}px, 0) scale(0.6)`;
                            setTimeout(() => {
                                showPopup(data.data);
                                resolve();
                            }, 500);
                        });
                    }, { once: true });
                });

            } catch (error) {
                console.error('Error:', error);
                alert(' Technical error in Landing . Please try again.');
                airplaneImage.classList.remove('loading-animation', 'landing');
            }
        }

        // Update the popup content to show more details
        function showPopup(data) {
            const popup = document.getElementById('onboardingPopup');
            const envDetail = document.getElementById('envDetail');
            const userIdDetail = document.getElementById('userIdDetail');
            const timestampDetail = document.getElementById('timestampDetail');
            const emailDetail = document.getElementById('emailDetail'); // Add this element to your HTML

            // Format timestamp to be more readable
            const timestamp = new Date(data.timestamp).toLocaleString();

            envDetail.textContent = data.environment.toUpperCase();
            userIdDetail.textContent = data.userId;
            timestampDetail.textContent = timestamp;
            if (emailDetail) {
                emailDetail.textContent = data.email;
            }

            // Add click-to-copy functionality
            const copyableElements = popup.querySelectorAll('span[id$="Detail"]');
            copyableElements.forEach(element => {
                element.style.cursor = 'pointer';
                element.title = 'Click to copy';
                element.onclick = async function() {
                    try {
                        await navigator.clipboard.writeText(this.textContent);
                        const originalText = this.textContent;
                        this.textContent = 'Copied!';
                        setTimeout(() => {
                            this.textContent = originalText;
                        }, 1000);
                    } catch (err) {
                        console.error('Failed to copy:', err);
                    }
                };
            });

            popup.style.display = 'block';
        }

        function closePopup() {
            const popup = document.getElementById('onboardingPopup');
            popup.style.display = 'none';
        }

        function playCountdown() {
            return new Promise((resolve) => {
                let count = 3;
                
                const countdownDisplay = document.createElement('div');
                countdownDisplay.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 72px;
                    color: white;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                    z-index: 1000;
                    font-weight: bold;
                `;
                document.body.appendChild(countdownDisplay);
                
                const countInterval = setInterval(() => {
                    if (count > 0) {
                        countdownDisplay.textContent = count;
                        count--;
                    } else {
                        clearInterval(countInterval);
                        countdownDisplay.textContent = 'GO!';
                        countdownDisplay.style.color = '#4CAF50';
                        setTimeout(() => {
                            countdownDisplay.remove();
                            resolve();
                        }, 1000);
                    }
                }, 1000);
            });
        }

        // Update the click event listener to remove audio error handling
        personImage.addEventListener('click', async () => {
            const selectedEnvironment = document.querySelector('input[name="environment"]:checked');
            
            if (!selectedEnvironment) {
                alert('Please select the destination first!');
                return;
            }

            try {
                // Reset airplane position and remove previous animations
                airplaneImage.classList.remove('flying-uat', 'flying-preprod');
                airplaneImage.style.transform = 'rotate(-10deg) translateX(20px)';
                airplaneImage.style.display = 'block';

                personImage.classList.add('clicked');

                // Call API first and wait for response
                const registrationData = await callRegistrationApi(selectedEnvironment.value);
                console.log('Registration successful:', registrationData);
                
                // Start countdown after successful registration
                await playCountdown();
                
                personImage.classList.remove('clicked');
                
                // Start the flight animation and show popup
                await startJourney(selectedEnvironment.value, registrationData);
            } catch (error) {
                console.error('Error:', error);
                alert('Technical error in Landing. Please try again.');
                personImage.classList.remove('clicked');
                airplaneImage.classList.remove('loading-animation', 'landing');
            }
        });

        // New function to handle the journey animation
        async function startJourney(environment, registrationData) {
            try {
                document.querySelectorAll('.destination').forEach(dest => {
                    dest.classList.remove('selected');
                });

                const selectedDest = document.querySelector(`input[value="${environment}"]`).closest('.destination');
                selectedDest.classList.add('selected');

                airplaneImage.classList.remove('loading-animation');
                airplaneImage.classList.add('landing');
                
                // Start flight animation
                if (environment === 'uat') {
                    airplaneImage.classList.add('flying-uat');
                } else {
                    airplaneImage.classList.add('flying-preprod');
                }
                
                // Wait for flight animation to complete
                await new Promise(resolve => {
                    airplaneImage.addEventListener('animationend', () => {
                        const destRect = selectedDest.getBoundingClientRect();
                        const containerRect = document.querySelector('.journey-container').getBoundingClientRect();
                        
                        const relativeX = destRect.left - containerRect.left + (destRect.width / 2) - 30;
                        const relativeY = destRect.top - containerRect.top + (destRect.height / 2) - 30;
                        
                        requestAnimationFrame(() => {
                            airplaneImage.style.transform = `translate3d(${relativeX}px, ${relativeY}px, 0) scale(0.6)`;
                            setTimeout(() => {
                                showPopup(registrationData.data);
                                resolve();
                            }, 500);
                        });
                    }, { once: true });
                });
            } catch (error) {
                console.error('Error during journey:', error);
                alert('Journey failed. Please try again.');
                airplaneImage.classList.remove('loading-animation', 'landing');
            }
        }

        document.querySelectorAll('.destination').forEach(dest => {
            dest.addEventListener('click', (e) => {
                if (e.target.type !== 'radio') {
                    const radio = dest.querySelector('input[type="radio"]');
                    radio.checked = true;
                }
            });
        });

        // Optional: Close popup when clicking outside
        window.onclick = function(event) {
            const popup = document.getElementById('onboardingPopup');
            if (event.target === popup) {
                closePopup();
            }
        }

        // Add background planes
        function createBackgroundPlanes() {
            for (let i = 0; i < 5; i++) {
                const plane = document.createElement('div');
                plane.className = 'background-plane';
                plane.style.top = `${Math.random() * 40}%`;
                plane.style.left = `${Math.random() * 100}%`;
                plane.style.transform = `scale(${0.5 + Math.random()})`;
                document.body.appendChild(plane);

                // Animate plane
                setInterval(() => {
                    const newLeft = (parseFloat(plane.style.left) + 0.1) % 100;
                    plane.style.left = `${newLeft}%`;
                }, 50);
            }
        }

        // Call this function after createClouds()
        createBackgroundPlanes();

        // Updated background image URLs
        const backgroundImages = [
            'https://wallpaperaccess.com/full/254381.jpg',
            'https://images.unsplash.com/photo-1436491865332-7a61a109cc05',
            'https://images.unsplash.com/photo-1490430657723-4d607c1503fc',
            'https://wallpapercave.com/wp/wp2763910.jpg'
        ];

        // Try loading the first image, if it fails, try the next one
        function loadBackgroundImage(index = 0) {
            if (index >= backgroundImages.length) return;
            
            const img = new Image();
            img.onload = () => {
                document.body.style.backgroundImage = `url('${backgroundImages[index]}')`;
            };
            img.onerror = () => {
                loadBackgroundImage(index + 1);
            };
            img.src = backgroundImages[index];
        }

        // Start loading background images
        loadBackgroundImage();

        // Add parallax effect
        document.addEventListener('mousemove', (e) => {
            const layers = document.querySelectorAll('.background-layer');
            const mouseX = e.clientX / window.innerWidth;
            const mouseY = e.clientY / window.innerHeight;

            layers.forEach((layer, index) => {
                const offsetX = (mouseX - 0.5) * (index + 1) * 20;
                const offsetY = (mouseY - 0.5) * (index + 1) * 20;
                layer.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(1.1)`;
            });
        });

        // Add dynamic light intensity based on time
        function updateLightIntensity() {
            const hour = new Date().getHours();
            const layer2 = document.querySelector('.layer-2');
            
            if (hour >= 18 || hour < 6) {
                // Night time - darker overlay
                layer2.style.background = 'linear-gradient(135deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.8) 100%)';
            } else {
                // Day time - lighter overlay
                layer2.style.background = 'linear-gradient(135deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.5) 100%)';
            }
        }

        updateLightIntensity();
        setInterval(updateLightIntensity, 60000); // Update every minute

        // Update the last update time periodically
        function updateLastUpdateTime() {
            const lastUpdate = document.getElementById('lastUpdate');
            const now = new Date();
            lastUpdate.textContent = now.toLocaleTimeString();
        }

        // Update time every minute
        setInterval(updateLastUpdateTime, 60000);
        updateLastUpdateTime(); // Initial update
    </script>
</body>
</html>
